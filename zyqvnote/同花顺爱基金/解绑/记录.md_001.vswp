vnote_backup_file_826537664 E:/study/Vnote/VNote/zyqvnote/同花顺爱基金/解绑/记录.md

2018-5-23  v1.2
修改记录：添加用key1-5 通过爱基金查同花顺


#### 账号打通 
##### 获取验证码
```
接口地址：https://trade.5ifund.com:8443/rs/loginservice/login/validata2?key1=460005898026847&key2=a63848a7eefb0579c55c944ac1773358
Get方式
返回:
{
    "url": null,
    "code": "0000",
    "custId": null,
    "singleData": {
        "validateuuid": "366b51d8-5fa3-4fea-a33a-e7a66ad2261e",
        "imgstr": "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"
    },
    "listData": null,
    "message": "获取验证码成功"
}
```
##### 旧版登录接口（目前线上使用）
```
接口地址：https://trade.5ifund.com:8443/rs/loginservice/login/withoutmobile2/withvalidate
Post方式 

key1:460005898026847
key2:a63848a7eefb0579c55c944ac1773358
rsLoginDto:{ "serviceId": "null", 
"operator": "121",  "dataSource": "null", 
"certificateType": "T", "certificateNo": "100000000004",
"tradePassword": "9CBF8A4DCB8E30682B927F352D6559A0",  
"ipAddress": "0",  "macAddress": "0", 
"rsConType": "0", "validateuuid": "366b51d8-5fa3-4fea-a33a-e7a66ad2261e",
"validatecode": "451613"}

返回：
{
    "url": null,
    "code": "0000",
    "custId": null,
    "singleData": {
        "key4": "0",
        "key3": "100000000004",
        "ovRETCODE": "0000",
        "dataSource": "WS",
        "key5": "DE5A2135549F47819F8FF813B609A2299F06D92DA94BD1D38923B629D4C2E7E5",
        "ovRETMSG": "成功",
        "tradePassword": "9CBF8A4DCB8E30682B927F352D6559A0",
        "serviceId": "8501",
        "accountInfo": [
            {
                "clientRiskRateText": "激进型",
                "mobileTelNo": "185****1522",
                "clientRiskRate": "5",
                "certificateType": "0",
                "certificateNo": "110106199005032715",
                "custId": "100000000004",
                "tradePassword": "9CBF8A4DCB8E30682B927F352D6559A0",
                "openAccoSteps": "0",
                "investorName": "宣钱萍一",
                "transactorName": null,
                "transactorCertType": null,
                "transactorCertNo": null,
                "verifyInfo": "宣钱萍一",
                "ipAddress": "0",
                "macAddress": "这是您第一次登录",
                "isEvaluating": "1",
                "lastLogTime": "2018年05月23日 19:06:16"
            }
        ],
        "certificateNo": "100000000004",
        "certificateType": "T",
        "operator": "121",
        "ipAddress": "0"
    },
    "listData": null,
    "message": "登陆成功"
}
```

##### 新版登录接口(带同花顺账号登录)----测试中
```
接口地址:https://trade.5ifund.com:9445/rs/loginservice/login/withoutmobile2
/withvalidate  
Post 方式  form表单提交  
rsLoginDto:{"thsUserId":"xxx","thsCookie":"xxx","operator":"xxxx"}  
key1:460005898026847   (写死)
key2:a63848a7eefb0579c55c944ac1773358 (写死)
```
结果 | Code | Msg  
- | :-: | -: 
校验未通过| 1000| 校验未通过
未绑定 | 9999 | 账号还未绑定，请前往绑定
 登录成功| 0000 | 登录成功

#####  爱基金账号和同花顺账号绑定
```
接口地址 ：https://trade.5ifund.com:8443/rs/bind/app/dobind/{userid}/result
post 方式 form表单提交  
key1:460005898026847   (写死)
key2:a63848a7eefb0579c55c944ac1773358 (写死)
key3:{userid}
key4:  登录后获取
key5:  登录后获取
pwd:xxx    （用户密码MD5后大写）
RsBindDTO：
{
  "custId": "100110009758",  
  "thsId": "414766901",
  "user":    (同花顺登录后cookie中的值) "MDpseWZfdGVzdDI4OjpOb25lOjUwMDo0MTU3NjY5MDE6NywxMTExMTExMTExMSw0MDs0NCwxMSw0MDs2LDEsNDA7NSwxLDQwOzEsMSw0MDsyLDEsNDA7MywxLDQwOzUsMSw0MDs4LDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxLDQwOjo6OjQxNDc2NjkwMToxNTIzNDM2NDIxOjo6MTUwNTczNDI2MDo0MDAzNzk6MDo0NDczMjJhYTViMmZmYjIxMmE4NWE3MmJkMTViOGU1NjQ6OjA",
  "ticket": "4fe3a561e2235b5e2fefdfd63f6660ab",(同花顺登录后cookie中的值)
  "sessionId": "1"
}
```

##### 根据爱基金查同花顺
```
接口地址1：https://trade.5ifund.com:8443/rs/bind/app/querybindpwd/100000000004/
result?pwd=9CBF8A4DCB8E30682B927F352D6559A0

接口地址2：https://trade.5ifund.com:8443/rs/bind/app/querybind/100110009758/result?key1=460005898026847&key2=a63848a7eefb0579c55c944ac1773358
&key3=100110009758&key4=1&
key5=55DF9688B62195A63379455EDC84508D4931A9CE41F8E477A73E735D4846036A
方式：Get方式
绑定后
{
    "url": null,
    "code": "0000",
    "custId": null,
    "singleData": {
        "thsUserId": "9096391",
        "account": "xwr168",
        "sessionid": "4216d651eec7b41a9931275ca7182194d"
    },
    "listData": null,
    "message": null
}

未绑定
{
    "url": null,
    "code": "9997",
    "custId": null,
    "singleData": null,
    "listData": null,
    "message": "查询失败，绑定关系不存在!"
}

不存在的测试账户
{
    "url": null,
    "code": "9100",
    "custId": null,
    "singleData": null,
    "listData": null,
    "message": "系统内部错误,查询同花顺信息失败"
}

密码错误
{
    "url": null,
    "code": "2000",
    "custId": null,
    "singleData": null,
    "listData": null,
    "message": "密码输入错误，还可以输入4次!"
}
```



##### 检查爱基金与同花顺是否绑定 (也可以互查id)
```
接口地址：https://trade.5ifund.com:8443/rs/bind/app/checkbind/{userid}/result
post 方式 form表单提交  
RsBindDTO:{"thsId":"xxx"}  
key1:460005898026847   (写死)
key2:a63848a7eefb0579c55c944ac1773358 (写死)
key3:{userid}
key4:                        登录后获取
key5:                        登录后获取


{
    "url": null,
    "code": "0000",
    "custId": null,
    "singleData": {
        "CheckBind": {
            "isFundBindThs_fund": "100000000004",  你查询的爱基金账号
            "isThsBindFund_fund": "",              和同花顺绑定的爱基金账号
            "isThsBindFund_ths": "xxx",            你查询的同花顺账号
            "isFundBindThs": "1",                  爱基金账号查同花顺的标志1表示绑定
            "isFundBindThs_ths": "9096391",        和爱基金绑定的同花顺账号
            "isThsBindFund": "0"                   同花顺查爱基金绑定的账号
        }
    },
    "listData": null,
    "message": "查询绑定关系成功"
}
```



##### 获取Token(绑定成功后)
```
接口地址：https://trade.5ifund.com:9445/fundsaleboot/bind/querytoken
post方式：json格式
{
	"custId":"100000000151"
}
```

##### 获取token后查询爱基金信息
```
接口地址：https://trade.5ifund.com:9445/rs/bind/ths/queryinfo/100110011325
/result?token=628aaf716dd1d3373087ac14aaac13ff
get方式
```



